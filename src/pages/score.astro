---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import HeroSection from "../components/HeroSection.astro";
---

<Layout title="Role Fit Score - Bounteer">
  <Header />

  <main>
    <!-- Hero Section -->
    <HeroSection
      title="Get Your Role Fit Score"
      highlightText="Role Fit Score"
      description="Instantly analyze how well your CV matches any job description. Get detailed insights and actionable recommendations."
      badge="‚ö° AI-Powered Career Matching"
    />

    <!-- Unified Card -->
    <section class="py-16 bg-white">
      <div class="container-custom max-w-6xl mx-auto">
        <div
          class="rounded-2xl border border-gray-200 shadow-xl p-10 bg-white flex flex-col"
        >
          <!-- Single Heading -->
          <h3 class="text-2xl font-semibold text-gray-900 mb-8">
            Upload JD and CV
          </h3>

          <!-- Inputs -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <!-- Job Description -->
            <div>
              <label
                for="job-description"
                class="block text-sm font-medium text-gray-700 mb-2"
              >
                Job Description (Text or URL)
              </label>
              <textarea
                id="job-description"
                class="w-full h-56 p-4 border rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-primary-500 focus:outline-none"
                placeholder="e.g. We are looking for a Senior Software Engineer with 5+ years experience in React, TypeScript, and Node.js. 
                
Or paste a job description URL here..."
                x-data
                x-ref="jdInput"></textarea>
            </div>

            <!-- Upload CV -->
            <div
              x-data="{ isDragging: false, fileName: '', error: '' }"
              @dragover.prevent="isDragging = true"
              @dragleave.prevent="isDragging = false"
              @drop.prevent="
                isDragging = false;
                const file = $event.dataTransfer.files[0];
                validateFile(file);
              "
              x-init="
                function validateFile(file) {
                  const maxSize = 10 * 1024 * 1024; // 10 MB
                  const allowedExtensions = ['pdf'];
                  const extension = file.name.split('.').pop().toLowerCase();

                  if (file.size > maxSize) {
                    error = 'File is too large. Maximum size is 10MB.';
                    fileName = '';
                    return;
                  }
                  if (!allowedExtensions.includes(extension)) {
                    error = 'Invalid file type. Only PDF is allowed.';
                    fileName = '';
                    return;
                  }
                  fileName = file.name;
                  error = '';
                }
              "
            >
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Upload CV (PDF only)
              </label>
              <div
                class="border-2 border-dashed rounded-lg p-8 text-center transition"
                :class="isDragging ? 'border-primary-500 bg-primary-50' : 'border-gray-300'"
              >
                <div class="flex flex-col items-center justify-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-12 w-12 text-gray-400 mb-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M12 12V4m0 8l-3-3m3 3l3-3"
                    ></path>
                  </svg>
                  <p class="text-sm text-gray-600">
                    Drag & Drop your CV here <br />
                    or <label
                      class="underline text-primary-600 cursor-pointer hover:text-primary-700"
                    >
                      <input
                        type="file"
                        accept="application/pdf"
                        class="hidden"
                        @change="validateFile($event.target.files[0])"
                      />
                      choose a file
                    </label>
                    <br />
                    Supports PDF up to 10MB
                  </p>

                  <!-- File Name -->
                  <template x-if="fileName">
                    <p class="mt-3 text-sm text-blue-600">
                      üìÑ <span x-text="fileName"></span>
                    </p>
                  </template>

                  <!-- Error Message -->
                  <template x-if="error">
                    <p class="mt-3 text-sm text-red-600" x-text="error"></p>
                  </template>

                  <!-- Success Note -->
                  <p
                    class="mt-3 text-xs text-green-600 bg-green-50 px-3 py-1 rounded-md"
                    x-show="!error && fileName"
                  >
                    ‚óè Your CV is never stored or shared
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Analyze Button -->
          <div class="mt-10">
            <button
              class="btn-primary w-full"
              :disabled="error || !fileName || !$refs.jdInput.value.trim()"
            >
              Analyze Role Fit
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
